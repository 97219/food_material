<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<script src="jquery.min.js"></script>
<script src="ajaxfileupload.js"></script>
<script>
$(document).ready(function(){
    $("#show_result").click(function(){
        $.ajax({
            type: 'POST',
            url: "http://127.0.0.1:8080/api/chamo/get_result",
            dataType: 'json',
            success: function(data) {
                $("#result").empty()
                for (var i=0;i<data.result.length;i++){
                    str='<img style="height:300px" src="http://127.0.0.1/result/'+data.result[i]+'">';
                    $("#result").append(str);
                }
            },
        })
    });
    $("#evalu").click(function(){
        $("#status_s").html('processing, please wait!!!!!!!!')
        $.ajax({
            type: 'POST',
            url: "http://127.0.0.1:8080/api/chamo/evaluation",
            dataType: 'json',
            success: function(data) {
                $("#status_s").html('')
                alert("eval completed!");
            },
        })
    });
    $("#tensorboard").click(function(){
        $.ajax({
            type: 'POST',
            url: "http://127.0.0.1:8080/api/chamo/tensorboard",
            dataType: 'json',
            success: function(data) {

            },
        })
    });
    $("#Training").click(function(){
        $.ajax({
            type: 'POST',
            url: "http://127.0.0.1:8080/api/chamo/train",
            dataType: 'json',
            success: function(data) {

            },
        })
    });
    $("#conv_tfrecord").click(function(){
        $("#status_s").html('processing, please wait!!!!!!!!')
        $.ajax({
            type: 'POST',
            url: "http://127.0.0.1:8080/api/chamo/conv_tfrecord",
            dataType: 'json',
            success: function(data) {
                $("#status_s").html('')
                alert("convert completed!");
            },
        })
    });
    $("#train_s_t").click(function(){
        $.ajax({
            type: 'POST',
            headers: {
                "Content-type": "application/json"
            },
            data:'{"proc_name":"python", "keyword":"main.py"}',
            url: "http://127.0.0.1:8080/api/chamo/check_proc",
            dataType: 'json',
            success: function(data) {
                if (data.re==1){
                    $("#train_s").html("training")
                }else{
                    $("#train_s").html("not training")
                }
            },
        })
    });
    $("#posi_scrap_btn").click(function(){
        key_word=$("#posi_keyword_input").val()
        key_word=key_word.replace(/\r\n/g,",")
        key_word=key_word.replace(/\n/g,",");
        console.log(key_word)
        scrap_num=$("#scrap_num").val()
        data_c='{"key_word":"'+key_word+'", "isPosi":"1", "maxcount":"'+scrap_num+'"}'
        $("#status_s").html('processing, please wait!!!!!!!!')
        $.ajax({
            type: 'POST',
            headers: {
                "Content-type": "application/json"
            },
            data:data_c,
            url: "http://127.0.0.1:8080/api/chamo/scrap",
            dataType: 'json',
            success: function(data) {
                $("#status_s").html('')
                $("#scrap_re").html('<a href="'+data.re+'" >download</a>')
            },
        })
    });
    $("#neg_scrap_btn").click(function(){
        key_word=$("#posi_keyword_input").val()
        key_word=key_word.replace(/\r\n/g,",")
        key_word=key_word.replace(/\n/g,",");
        scrap_num=$("#scrap_num").val()
        data_c='{"key_word":"'+key_word+'", "isPosi":"0", "maxcount":"'+scrap_num+'"}'
        $("#status_s").html('processing, please wait!!!!!!!!')
        $.ajax({
            type: 'POST',
            headers: {
                "Content-type": "application/json"
            },
            data:data_c,
            url: "http://127.0.0.1:8080/api/chamo/scrap",
            dataType: 'json',
            success: function(data) {
                $("#status_s").html('')
                $("#scrap_re").html('<a href="'+data.re+'" >download</a>')
            },
        })
    });
    $("#new_scrap_btn").click(function(){
        key_word=$("#posi_keyword_input").val()
        $.ajax({
            type: 'POST',
            headers: {
                "Content-type": "application/json"
            },
            data:"{}",
            url: "http://127.0.0.1:8080/api/chamo/scrap",
            dataType: 'json',
            success: function(data) {
                $("#scrap_re").html('')
            },
        })
    });
    $("#merge_upload").click(function(){
        key_word=$("#posi_keyword_input").val()
        $("#status_s").html('processing, please wait!!!!!!!!')
        $.ajax({
            type: 'POST',
            url: "http://127.0.0.1:8080/api/chamo/merge_upload",
            dataType: 'json',
            success: function(data) {
                alert("merge completed!");
                $("#status_s").html('')
            },
        })
    });

    $("#update_material").click(function(){
        $.ajax({
            type: 'POST',
            url: "http://127.0.0.1:8080/api/chamo/update_material",
            dataType: 'json',
            success: function(data) {
                $("#materil_list").html(data.re)
            },
        })
    });
    $("#release_model").click(function(){
        $.ajax({
            type: 'POST',
            url: "http://127.0.0.1:8080/api/chamo/release_model",
            dataType: 'json',
            success: function(data) {
            },
        })
    });


});

$(function () {
    $("#saveImg").click(function () {
        var ths=$('#fileImg');
        if (ths.val().length <= 0) {
            alert("plesae specify a file");
            return false;
        }
        ajaxFileUpload("http://127.0.0.1:8080/api/chamo/img_upload", 'fileImg');
        return true;
    })
})

function ajaxFileUpload(addr, eleId) {
    $.ajaxFileUpload({
        url:addr,
        type: 'post',
        secureuri: false,
        fileElementId: eleId,
        dataType: 'constant',
        success: function(data) {
            alert("upload success!");
        },
        error: function (data, status, e)
        {

        }
    })
    return false;
}
</script>
</head>
<body>
<div id="status_s"></div>
<button id="show_result">show result</button>
<button id="evalu">evaluation</button>
<button id="tensorboard">Toggle Tensorboard</button>
<button id="Training">Toggle Training</button>
<button id="train_s_t">Check Training Statues</button>
<button id="conv_tfrecord">Convert Tfrecord</button>
<br>
<button id="merge_upload">Merge Upload</button>
<button id="update_material">Update Materials</button>
<button id="release_model">Release Model</button>
<br>
<div id="train_s"></div>
<br>
<input type="text" id="scrap_num" value="500">
<br>
<textarea id="posi_keyword_input" style="width:200px;height:80px;"></textarea>>
<button id="new_scrap_btn">New Scrap</button>
<button id="posi_scrap_btn">Scrap Posi</button>
<button id="neg_scrap_btn">Scrap Neg</button>
<div id="scrap_re"></div>
<br>
    <input id="fileImg" type="file" name="fileImg" size="80" />
    <input id="saveImg" type="button" value="evl img"  />

<div id="materil_list"></div>
<div id="result"></div>
</body>
</html>
